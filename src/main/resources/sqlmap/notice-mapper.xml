<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="notice.mapper">

	<!-- 공지글 상세 내용 조회 -->
	<select id="detail" resultType="notice.NoticeVO">
		select tbl_board.* , (select name from user_member where user_member.id = tbl_board.board_writer) name from tbl_board where board_num = #{board_num}
	</select>


	<!-- 공지사항 신규 글 등록 처리 -->
	<insert id="insert">
		insert into tbl_board (board_code, board_num, root, board_write_date, board_edit_date, board_title, board_content, board_writer, filename, filepath, commcode, subcode )
		values (seq_board_code.nextval, seq_board_num.nextval, seq_board_num.currval, sysdate, sysdate, #{board_title}, #{board_content}, #{board_writer}, 
			#{filename, jdbcType=VARCHAR}, #{filepath, jdbcType=VARCHAR}, 4, 1 )				
	</insert>

	<sql id ='where_search'>
		<!-- 제목에 테스트 문자가 있는 것을 조회 한다면 where title like '테스트' -->
		<if test="search == 'board_title' or search == 'board_content' "> 
			where ${search} like '%'||#{keyword}||'%'
		</if>
		<if test="search == 'board_writer' ">
			where board_writer in (select id from user_member where name like '%'||#{keyword}||'%' )		
		</if>
		
		<if test="search == 'all' "> 
			where board_title like '%'||#{keyword}||'%'
			or board_content like '%'||#{keyword}||'%'
			or board_writer in (select id from user_member where name like '%'||#{keyword}||'%' )
		</if>
	</sql>


	<!-- 전체 게시글 수 조회 -->
	<select id="totalList" resultType="integer">
		select count(*) from tbl_board 
	</select>
	
	<!-- 페이지 처리된 글 목록 조회 -->
	<select id="list" resultType="notice.NoticeVO">
		select * 
		from (select rownum no, n.*, (select name from user_member where user_member.id = board_writer) name
				from (select * from tbl_board <include refid="where_search" /> 
				order by root, step desc) n
				order by no desc)
		where no between #{beginList} and #{endList}
	</select>

		<!-- 공지사항 전체 글 목록 조회  -->
<!-- 	<select id="list" resultType="notice.NoticeVO"> -->
<!-- 		// select * from tbl_board		 -->
<!-- 		select rownum no, n.*, (select name from user_member where member.id = board_writer) name   -->
<!-- 		from (select * from tbl_board order by id) n -->
<!-- 		order by no desc  -->
<!-- 	</select> -->
	
</mapper>